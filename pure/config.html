<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuraci√≥n - Sistema TITO</title>
  <link rel="stylesheet" href="./style.css" />
  <style>
    body{font-family:system-ui,Segoe UI,Arial;background:#0b1220;color:#e5e7eb;margin:0;padding:0}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .card{background:#0f172a;border:1px solid #1f2937;border-radius:12px;padding:24px;margin:16px 0}
    .card h2{margin-top:0;color:#3b82f6;font-size:24px}
    .card p{color:#9ca3af;margin:8px 0 20px 0}
    .config-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-top:24px}
    .config-item{background:#111827;border:1px solid #334155;border-radius:10px;padding:20px;cursor:pointer;transition:all 0.3s ease}
    .config-item:hover{background:#1f2937;border-color:#3b82f6;transform:translateY(-2px);box-shadow:0 4px 12px rgba(59,130,246,0.2)}
    .config-icon{font-size:36px;margin-bottom:12px}
    .config-title{font-size:18px;font-weight:600;margin-bottom:8px;color:#e5e7eb}
    .config-desc{font-size:14px;color:#9ca3af;line-height:1.5}
    .button{padding:10px 16px;border-radius:8px;border:1px solid #334155;background:#1f2937;color:#e5e7eb;cursor:pointer;font-size:14px;font-weight:500}
    .button:hover{background:#2d3748}
    .button.primary{background:#3b82f6;border-color:#3b82f6}
    .button.primary:hover{background:#2563eb}
    header{background:#0f172a;border-bottom:1px solid #1f2937;padding:16px 24px;display:flex;justify-content:space-between;align-items:center}
    header h1{margin:0;font-size:24px}
    .badge{display:inline-block;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;margin-left:8px}
    .badge.admin{background:#3b82f620;color:#3b82f6}
    .badge.soon{background:#f59e0b20;color:#f59e0b}
    .badge.active{background:#10b98120;color:#10b981}
    footer{text-align:center;padding:20px;color:#6b7280;font-size:13px;border-top:1px solid #1f2937;margin-top:40px}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>‚öôÔ∏è Configuraci√≥n del Sistema <span class="badge admin">Solo Administrador</span></h1>
      <p style="margin:4px 0 0 0;color:#9ca3af;font-size:14px">Gesti√≥n y configuraci√≥n general del sistema TITO</p>
    </div>
    <nav>
      <button class="button" id="btnVolver">‚Üê Volver al Panel</button>
    </nav>
  </header>

  <main class="container">
    <!-- Gesti√≥n de Operadores -->
    <section class="card">
      <h2>üë• Gesti√≥n de Operadores</h2>
      <p>Administra los operadores del casino que pueden emitir tickets desde las mesas</p>

      <div class="config-grid">
        <div class="config-item" onclick="abrirOperadores()">
          <div class="config-icon">üë§</div>
          <div class="config-title">Operadores <span class="badge active">Activo</span></div>
          <div class="config-desc">
            Crear, editar, activar/desactivar operadores.
            Asignar mesas espec√≠ficas a cada operador.
          </div>
        </div>
      </div>
    </section>

    <!-- Configuraci√≥n del Sistema (Pr√≥ximamente) -->
    <section class="card">
      <h2>üîß Configuraci√≥n del Sistema</h2>
      <p>Ajustes generales del sistema, base de datos, e impresoras</p>

      <div class="config-grid">
        <div class="config-item" onclick="abrirUsuarios()">
          <div class="config-icon">üë®‚Äçüíº</div>
          <div class="config-title">Usuarios del Sistema <span class="badge active">Activo</span></div>
          <div class="config-desc">
            Gestionar usuarios con roles Admin, Mesa, Caja y Auditor.
            Configurar permisos, contrase√±as y PINs.
          </div>
        </div>

        <div class="config-item" style="opacity:0.6;cursor:not-allowed">
          <div class="config-icon">üñ®Ô∏è</div>
          <div class="config-title">Impresoras <span class="badge soon">Pr√≥ximamente</span></div>
          <div class="config-desc">
            Configurar impresoras t√©rmicas de tickets.
            Ajustar tama√±os de papel y perfiles de impresi√≥n.
          </div>
        </div>

        <div class="config-item" style="opacity:0.6;cursor:not-allowed">
          <div class="config-icon">üíæ</div>
          <div class="config-title">Base de Datos <span class="badge soon">Pr√≥ximamente</span></div>
          <div class="config-desc">
            Configurar conexi√≥n a Supabase.
            Backup y restauraci√≥n de datos.
          </div>
        </div>

        <div class="config-item" style="opacity:0.6;cursor:not-allowed">
          <div class="config-icon">üí∞</div>
          <div class="config-title">Monedas y Valores <span class="badge soon">Pr√≥ximamente</span></div>
          <div class="config-desc">
            Configurar monedas aceptadas (DOP, USD).
            Valores por defecto para emisi√≥n de tickets.
          </div>
        </div>

        <div class="config-item" style="opacity:0.6;cursor:not-allowed">
          <div class="config-icon">üìä</div>
          <div class="config-title">Logs del Sistema <span class="badge soon">Pr√≥ximamente</span></div>
          <div class="config-desc">
            Ver historial de acciones del sistema.
            Auditor√≠a de cambios y errores.
          </div>
        </div>

        <div class="config-item" style="opacity:0.6;cursor:not-allowed">
          <div class="config-icon">üîê</div>
          <div class="config-title">Seguridad <span class="badge soon">Pr√≥ximamente</span></div>
          <div class="config-desc">
            Configurar pol√≠ticas de seguridad.
            Gesti√≥n de sesiones y autenticaci√≥n.
          </div>
        </div>
      </div>
    </section>

    <!-- Informaci√≥n del Sistema -->
    <section class="card">
      <h2>‚ÑπÔ∏è Informaci√≥n del Sistema</h2>
      <div style="background:#111827;border:1px solid #334155;border-radius:8px;padding:16px">
        <div style="display:grid;grid-template-columns:200px 1fr;gap:12px">
          <div style="color:#9ca3af">Versi√≥n:</div>
          <div style="font-weight:600">1.0.0</div>

          <div style="color:#9ca3af">Sistema:</div>
          <div style="font-weight:600">TITO Casino Voucher System</div>

          <div style="color:#9ca3af">Base de datos:</div>
          <div style="font-weight:600">Supabase + SQLite</div>

          <div style="color:#9ca3af">Estado Supabase:</div>
          <div id="supabase-status" style="font-weight:600;color:#10b981">üü¢ Conectado</div>

          <div style="color:#9ca3af">Health Monitor:</div>
          <div id="health-status" style="font-weight:600;color:#10b981">üü¢ Activo</div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <small>Sistema TITO ¬∑ Configuraci√≥n ¬∑ Solo Administrador</small>
  </footer>

  <script>
    // ============================================
    // NAVEGACI√ìN
    // ============================================
    document.getElementById('btnVolver').addEventListener('click', async () => {
      console.log('üîô Volviendo al panel...');
      try {
        await window.api?.invoke?.('open-view', 'panel');
      } catch (error) {
        console.error('Error volviendo al panel:', error);
        window.location.href = '../Caja/panel.html';
      }
    });

    // ============================================
    // ABRIR M√ìDULO DE OPERADORES
    // ============================================
    async function abrirOperadores() {
      console.log('üë§ Abriendo gesti√≥n de operadores...');
      try {
        const result = await window.api?.invoke?.('open-view', 'operadores');
        if (!result?.success) {
          console.error('‚ùå Error abriendo operadores:', result?.error);
          alert('Error al abrir gesti√≥n de operadores');
        }
      } catch (error) {
        console.error('‚ùå Error:', error);
        alert('Error al abrir gesti√≥n de operadores');
      }
    }

    // ============================================
    // ABRIR M√ìDULO DE USUARIOS
    // ============================================
    async function abrirUsuarios() {
      console.log('üë®‚Äçüíº Abriendo gesti√≥n de usuarios...');
      try {
        const result = await window.api?.invoke?.('open-view', 'usuarios');
        if (!result?.success) {
          console.error('‚ùå Error abriendo usuarios:', result?.error);
          alert('Error al abrir gesti√≥n de usuarios');
        }
      } catch (error) {
        console.error('‚ùå Error:', error);
        alert('Error al abrir gesti√≥n de usuarios');
      }
    }

    // ============================================
    // VERIFICAR ESTADO DEL SISTEMA
    // ============================================
    async function verificarEstado() {
      try {
        // Verificar Supabase
        const healthResult = await window.api?.invoke?.('health-check');
        if (healthResult?.success && healthResult?.health) {
          const supabaseEl = document.getElementById('supabase-status');
          const healthEl = document.getElementById('health-status');

          // Estado Supabase (estimado)
          if (healthResult.health.status === 'healthy') {
            supabaseEl.textContent = 'üü¢ Conectado';
            supabaseEl.style.color = '#10b981';
          } else {
            supabaseEl.textContent = 'üü° Verificando...';
            supabaseEl.style.color = '#f59e0b';
          }

          // Estado Health Monitor
          if (healthResult.health.timedoutOperations > 0) {
            healthEl.textContent = 'üî¥ Con problemas';
            healthEl.style.color = '#ef4444';
          } else if (healthResult.health.runningOperations > 3) {
            healthEl.textContent = 'üü° Carga alta';
            healthEl.style.color = '#f59e0b';
          } else {
            healthEl.textContent = 'üü¢ Activo';
            healthEl.style.color = '#10b981';
          }
        }
      } catch (error) {
        console.warn('No se pudo verificar estado:', error);
      }
    }

    // Verificar estado al cargar
    document.addEventListener('DOMContentLoaded', () => {
      console.log('‚öôÔ∏è M√≥dulo de Configuraci√≥n cargado');
      verificarEstado();
      // Actualizar cada 10 segundos
      setInterval(verificarEstado, 10000);
    });

    // Sistema de salud anti-cuelgues: cargar indicador visual
    (async function cargarIndicadorSalud() {
      try {
        const response = await fetch('health-indicator.html');
        const html = await response.text();
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        while (tempDiv.firstChild) {
          document.body.appendChild(tempDiv.firstChild);
        }
        console.log('‚úÖ Indicador de salud cargado');
      } catch (e) {
        console.warn('‚ùå No se pudo cargar indicador de salud:', e.message);
      }
    })();
  </script>
</body>
</html>
