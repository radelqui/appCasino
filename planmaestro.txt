ğŸ° PROMPT COMPLETO: Sistema de Vouchers Casino con QR - Windows Desktop
ğŸ“‹ CONTEXTO Y OBJETIVO
Desarrolla una aplicaciÃ³n desktop para Windows usando Electron + React para el Gran Casino SosÃºa (Coral Reef Casino). El sistema gestiona vouchers/tickets tipo TITO (Ticket-In Ticket-Out) con cÃ³digos QR para operaciones de cashout en mesas de juego y caja.
ğŸ¯ REQUISITOS FUNCIONALES
1. ARQUITECTURA TÃ‰CNICA

Frontend: React con Tailwind CSS
Backend: Electron (proceso principal)
Base de Datos: SQLite local (primaria) + Supabase (sincronizaciÃ³n/respaldo)
Seguridad: QR con hash SHA256 para evitar falsificaciÃ³n
ImpresiÃ³n: Soporte para impresoras tÃ©rmicas ESC/POS vÃ­a USB
Scanner: Soporte para lectores QR USB (emulaciÃ³n teclado)

2. ESTRUCTURA DE CARPETAS
casino-voucher-system/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/                    # Proceso principal Electron
â”‚   â”‚   â”œâ”€â”€ main.js             # Entry point
â”‚   â”‚   â”œâ”€â”€ preload.js          # Preload script
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ sqlite.js       # SQLite local operations
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase.js     # Supabase sync
â”‚   â”‚   â”‚   â””â”€â”€ schema.sql      # DB schema
â”‚   â”‚   â”œâ”€â”€ hardware/
â”‚   â”‚   â”‚   â”œâ”€â”€ printer.js      # ESC/POS printer
â”‚   â”‚   â”‚   â””â”€â”€ scanner.js      # QR scanner handler
â”‚   â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”‚   â””â”€â”€ qr-crypto.js    # QR generation with hash
â”‚   â”‚   â”œâ”€â”€ ipc/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.js        # IPC registry
â”‚   â”‚   â”‚   â”œâ”€â”€ ticketHandlers.js
â”‚   â”‚   â”‚   â””â”€â”€ syncHandlers.js
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ pdf-generator.js # PDF backup generation
â”‚   â””â”€â”€ renderer/                # React frontend
â”‚       â”œâ”€â”€ index.js            # React entry
â”‚       â”œâ”€â”€ App.jsx
â”‚       â”œâ”€â”€ views/
â”‚       â”‚   â”œâ”€â”€ Mesa/           # Operator view
â”‚       â”‚   â”‚   â”œâ”€â”€ MesaView.jsx
â”‚       â”‚   â”‚   â””â”€â”€ TicketGenerator.jsx
â”‚       â”‚   â”œâ”€â”€ Caja/           # Cashier view
â”‚       â”‚   â”‚   â”œâ”€â”€ CajaView.jsx
â”‚       â”‚   â”‚   â””â”€â”€ TicketValidator.jsx
â”‚       â”‚   â””â”€â”€ Auditoria/      # Audit panel
â”‚       â”‚       â””â”€â”€ AuditoriaView.jsx
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ TicketPreview/  # Ticket component
â”‚           â”‚   â”œâ”€â”€ TicketPreview.jsx
â”‚           â”‚   â””â”€â”€ TicketPreview.css
â”‚           â””â”€â”€ shared/
â”‚               â”œâ”€â”€ Header.jsx
â”‚               â””â”€â”€ ConnectionStatus.jsx
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ logo-coral-reef.png
â”‚   â””â”€â”€ fonts/
â”œâ”€â”€ package.json
â””â”€â”€ electron-builder.json
```

## ğŸ¨ DISEÃ‘O DE TICKETS

### Estructura del Ticket FÃ­sico:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸŒ´ CORAL REEF CASINO ğŸŒ´     â”‚
â”‚        GRAN CASINO SOSÃšA         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚       CASHOUT VOUCHER            â”‚
â”‚                                  â”‚
â”‚        [CÃ“DIGO QR AQUÃ]          â”‚
â”‚                                  â”‚
â”‚    ||||||||||||||||||||||||      â”‚
â”‚       (CÃ“DIGO DE BARRAS)         â”‚
â”‚                                  â”‚
â”‚  VALIDATION: DD/MM/YYYY HH:MM    â”‚
â”‚  TICKET #: XXXX-XXXX             â”‚
â”‚                                  â”‚
â”‚  QUINIENTOS PESOS DOMINICANOS    â”‚
â”‚      $500.00 DOP                 â”‚
â”‚                                  â”‚
â”‚  VOID AFTER 365 DAYS             â”‚
â”‚  MACHINE #: XXX                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
DiferenciaciÃ³n por Moneda:

USD: Borde y header VERDE (#00A86B), fondo degradado verde claro
DOP: Borde y header AZUL (#0052CC), fondo degradado azul claro

ğŸ“Š MODELO DE DATOS
SQLite Schema:
sql-- Tabla principal de tickets
CREATE TABLE tickets (
    id TEXT PRIMARY KEY,
    codigo TEXT UNIQUE NOT NULL,
    monto DECIMAL(10,2) NOT NULL,
    moneda TEXT CHECK(moneda IN ('USD', 'DOP')) NOT NULL,
    estado TEXT CHECK(estado IN ('activo', 'canjeado', 'expirado', 'cancelado')) DEFAULT 'activo',
    mesa_id INTEGER NOT NULL,
    operador_id TEXT NOT NULL,
    cajero_id TEXT,
    fecha_emision DATETIME DEFAULT CURRENT_TIMESTAMP,
    fecha_canje DATETIME,
    hash_seguridad TEXT NOT NULL,
    sincronizado BOOLEAN DEFAULT 0,
    qr_data TEXT NOT NULL,
    codigo_barras TEXT NOT NULL
);

-- Ãndices para bÃºsquedas rÃ¡pidas
CREATE INDEX idx_codigo ON tickets(codigo);
CREATE INDEX idx_estado ON tickets(estado);
CREATE INDEX idx_fecha_emision ON tickets(fecha_emision);
CREATE INDEX idx_sincronizado ON tickets(sincronizado);

-- Tabla de operadores
CREATE TABLE operadores (
    id TEXT PRIMARY KEY,
    nombre TEXT NOT NULL,
    pin TEXT NOT NULL,
    mesa_asignada INTEGER,
    activo BOOLEAN DEFAULT 1
);

-- Tabla de auditorÃ­a
CREATE TABLE auditoria (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    tipo_evento TEXT NOT NULL,
    ticket_id TEXT,
    usuario_id TEXT,
    descripcion TEXT,
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP,
    ip_address TEXT,
    FOREIGN KEY (ticket_id) REFERENCES tickets(id)
);
Supabase Schema (idÃ©ntico + campos extra):
sql-- Agregar a Supabase:
ALTER TABLE tickets ADD COLUMN casino_id TEXT DEFAULT 'CORAL-REEF-SOSUA';
ALTER TABLE tickets ADD COLUMN sync_timestamp TIMESTAMP;
ALTER TABLE tickets ADD COLUMN version INTEGER DEFAULT 1;
ğŸ” SEGURIDAD Y GENERACIÃ“N DE QR
Estructura del contenido QR:
javascript// Formato del QR
const qrContent = {
  id: "CSR-2024-001234",        // Prefijo casino + aÃ±o + secuencial
  amount: 500.00,                // Monto
  currency: "DOP",               // USD o DOP
  timestamp: 1703001234567,      // Unix timestamp
  mesa: 3,                       // NÃºmero de mesa
  hash: "a3f5b2c8..."           // SHA256(id + amount + currency + timestamp + SECRET)
};

// CodificaciÃ³n final
const qrString = `CSR-2024-001234|500.00|DOP|1703001234567|3|a3f5b2c8...`;

// CÃ³digo de barras (CODE128)
const barcode = "CSR2024001234"; // Solo el ID simplificado
ValidaciÃ³n de Seguridad:
javascript// Al validar un QR:
1. Decodificar QR
2. Verificar hash SHA256
3. Verificar que existe en BD
4. Verificar estado = 'activo'
5. Verificar no expirado (365 dÃ­as)
6. Marcar como canjeado
7. Registrar en auditorÃ­a
ğŸ’» FUNCIONALIDADES POR VISTA
Vista MESA (Operadores):
javascript// Funciones disponibles:
- Login con PIN de operador
- Seleccionar moneda (USD/DOP)
- Ingresar monto
- Generar ticket con QR
- Imprimir automÃ¡ticamente
- Ver Ãºltimos 10 tickets generados
- Cancelar Ãºltimo ticket (supervisor)
Vista CAJA (Cajeros):
javascript// Funciones disponibles:
- Login cajero
- Escanear QR (input automÃ¡tico por scanner USB)
- Validar ticket
- Mostrar monto y moneda
- Confirmar pago
- Marcar como canjeado
- Reimprimir comprobante
- Ver tickets canjeados del turno
Vista AUDITORÃA (Admin):
javascript// Funciones disponibles:
- Dashboard con estadÃ­sticas
- BÃºsqueda por fecha/mesa/estado
- Exportar reportes (Excel/PDF)
- Ver log de eventos
- Tickets pendientes de canje
- Tickets expirados
- GrÃ¡ficos de operaciÃ³n
- SincronizaciÃ³n manual con Supabase
ğŸ–¨ï¸ CONFIGURACIÃ“N DE IMPRESORA
ESC/POS Commands para ticket:
javascriptconst printCommands = [
  ESC_INIT,
  ESC_ALIGN_CENTER,
  ESC_BOLD_ON,
  "CORAL REEF CASINO\n",
  ESC_BOLD_OFF,
  "GRAN CASINO SOSUA\n",
  ESC_LINE,
  "CASHOUT VOUCHER\n",
  ESC_QR_CODE(qrData),
  ESC_BARCODE(barcodeData),
  ESC_ALIGN_LEFT,
  `VALIDATION: ${fecha}\n`,
  `TICKET #: ${codigo}\n`,
  ESC_BOLD_ON,
  ESC_SIZE_DOUBLE,
  `$${monto} ${moneda}\n`,
  ESC_SIZE_NORMAL,
  ESC_BOLD_OFF,
  "VOID AFTER 365 DAYS\n",
  `MACHINE #: ${mesa}\n`,
  ESC_CUT
];
ğŸ”„ SINCRONIZACIÃ“N
Estrategia HÃ­brida:

OperaciÃ³n Principal: SQLite local (velocidad y confiabilidad)
Respaldo: SincronizaciÃ³n con Supabase cada 5 minutos
Fallback: Si no hay internet, acumula cambios localmente
Recovery: Al recuperar conexiÃ³n, sincroniza automÃ¡ticamente

LÃ³gica de Sync:
javascript// Cada 5 minutos o manual:
1. Verificar conexiÃ³n internet
2. Obtener tickets no sincronizados (sincronizado = 0)
3. Enviar batch a Supabase
4. Marcar como sincronizados
5. Descargar tickets de otras terminales
6. Log de sincronizaciÃ³n
ğŸ¯ CONFIGURACIÃ“N Y VARIABLES DE ENTORNO
.env file:
env# Base de Datos
SQLITE_DB_PATH=./data/casino.db
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_ANON_KEY=xxxxx
SUPABASE_SERVICE_KEY=xxxxx

# Seguridad
QR_SECRET=CASINO_CORAL_REEF_SECRET_KEY_2024
TICKET_EXPIRY_DAYS=365

# Hardware
PRINTER_NAME=EPSON_TM_T20
PRINTER_PORT=USB
SCANNER_MODE=KEYBOARD

# Casino Config
CASINO_ID=CORAL-REEF-SOSUA
CASINO_NAME=Gran Casino SosÃºa
DEFAULT_CURRENCY=DOP
USD_TO_DOP_RATE=57.50

# App Config
PORT=3000
NODE_ENV=production
AUTO_SYNC_INTERVAL=300000
ğŸ“¦ DEPENDENCIAS PRINCIPALES
json{
  "dependencies": {
    "electron": "^27.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "tailwindcss": "^3.3.0",
    "better-sqlite3": "^9.0.0",
    "@supabase/supabase-js": "^2.38.0",
    "qrcode": "^1.5.3",
    "jsbarcode": "^3.11.5",
    "node-thermal-printer": "^4.4.0",
    "crypto-js": "^4.2.0",
    "electron-store": "^8.1.0",
    "react-router-dom": "^6.20.0",
    "recharts": "^2.10.0",
    "xlsx": "^0.18.5",
    "date-fns": "^2.30.0"
  },
  "devDependencies": {
    "electron-builder": "^24.6.0",
    "concurrently": "^8.2.0",
    "wait-on": "^7.2.0"
  }
}
ğŸš€ SCRIPTS DE INICIO
json{
  "scripts": {
    "start": "concurrently \"npm run react-start\" \"wait-on http://localhost:3000 && npm run electron-start\"",
    "react-start": "react-scripts start",
    "electron-start": "electron .",
    "build": "npm run react-build && npm run electron-build",
    "react-build": "react-scripts build",
    "electron-build": "electron-builder",
    "dist": "electron-builder --publish=never"
  }
}
âœ… CRITERIOS DE Ã‰XITO

GeneraciÃ³n: Ticket impreso en < 2 segundos
ValidaciÃ³n: QR validado en < 500ms
Seguridad: Imposible duplicar o falsificar tickets
Confiabilidad: Opera sin internet
SincronizaciÃ³n: Datos respaldados cada 5 minutos
AuditorÃ­a: 100% trazabilidad de operaciones
Usabilidad: Interfaz simple, mÃ­nima capacitaciÃ³n

ğŸ¨ ESTILOS VISUALES

Tema Principal: Profesional casino, colores coral/turquesa
Fuentes: Roboto (UI), Courier (cÃ³digos)
IconografÃ­a: Lucide React Icons
Animaciones: Transiciones suaves, feedback visual inmediato
Responsive: Optimizado para tablets y PCs touch

ğŸ“ NOTAS IMPORTANTES

Prioridad #1: El sistema DEBE funcionar sin internet
Impresoras: CÃ³digo compatible con EPSON TM-T20/T88
Scanner: Configurar como entrada de teclado (HID)
Respaldos: Backup automÃ¡tico SQLite cada hora
Logs: Guardar 90 dÃ­as de auditorÃ­a
ExpiraciÃ³n: Tickets vÃ¡lidos 365 dÃ­as
Timezone: Usar hora local RepÃºblica Dominicana (AST)


INSTRUCCIÃ“N FINAL: Desarrolla este sistema completo, creando todos los archivos necesarios con cÃ³digo funcional y listo para producciÃ³n. Incluye manejo de errores, validaciones, logs, y todos los componentes descritos. El sistema debe ser robusto, seguro y fÃ¡cil de mantener.ReintentarClaude puede cometer errores. Por favor, verifique las respuestas.